03dea67a3058c6cb9407a6f62c669c65
"use strict";
/**
 * OpenSCAD Code Formatter
 *
 * Provides basic formatting for OpenSCAD code:
 * - Consistent indentation
 * - Spacing around operators
 * - Bracket alignment
 * - Removes trailing whitespace
 * - Removes excessive blank lines
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.formatOpenScadCode = formatOpenScadCode;
const DEFAULT_OPTIONS = {
    indentSize: 4,
    useTabs: false,
};
function formatOpenScadCode(code, options = {}) {
    const opts = { ...DEFAULT_OPTIONS, ...options };
    const indentStr = opts.useTabs ? '\t' : ' '.repeat(opts.indentSize);
    // Split into lines and remove trailing whitespace
    const lines = code.split('\n').map(line => line.trimEnd());
    const formatted = [];
    let indentLevel = 0;
    let lastLineWasBlank = false;
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const trimmed = line.trim();
        // Skip multiple consecutive blank lines
        if (trimmed === '') {
            if (!lastLineWasBlank) {
                formatted.push('');
                lastLineWasBlank = true;
            }
            continue;
        }
        lastLineWasBlank = false;
        // Count opening and closing braces to determine indent
        let openBraces = 0;
        let closeBraces = 0;
        let inString = false;
        let inLineComment = false;
        let inBlockComment = false;
        // First pass: count braces (ignore those in strings/comments)
        for (let j = 0; j < trimmed.length; j++) {
            const char = trimmed[j];
            const nextChar = trimmed[j + 1];
            const prevChar = trimmed[j - 1];
            // String handling
            if (char === '"' && prevChar !== '\\') {
                inString = !inString;
                continue;
            }
            if (inString)
                continue;
            // Line comment
            if (char === '/' && nextChar === '/' && !inBlockComment) {
                inLineComment = true;
                break; // Rest of line is comment
            }
            // Block comment
            if (char === '/' && nextChar === '*' && !inLineComment) {
                inBlockComment = true;
                j++; // Skip next char
                continue;
            }
            if (char === '*' && nextChar === '/' && inBlockComment) {
                inBlockComment = false;
                j++; // Skip next char
                continue;
            }
            if (inBlockComment)
                continue;
            // Count braces
            if (char === '{')
                openBraces++;
            if (char === '}')
                closeBraces++;
        }
        // Determine indent for this line
        // If line starts with }, decrease indent before
        let lineIndent = indentLevel;
        if (trimmed.startsWith('}')) {
            lineIndent = Math.max(0, indentLevel - 1);
        }
        // Format the line content (add spacing, etc.)
        const formattedContent = formatLineContent(trimmed);
        // Add the formatted line with proper indentation
        formatted.push(indentStr.repeat(lineIndent) + formattedContent);
        // Update indent level for next line
        // Closing braces decrease level
        indentLevel = Math.max(0, indentLevel - closeBraces);
        // Opening braces increase level
        indentLevel += openBraces;
    }
    // Remove trailing blank lines and ensure single newline at end
    while (formatted.length > 0 && formatted[formatted.length - 1].trim() === '') {
        formatted.pop();
    }
    return formatted.join('\n') + '\n';
}
/**
 * Format the content of a single line (spacing around operators, etc.)
 */
const MULTI_CHAR_OPERATORS = ['<=', '>=', '==', '!=', '+=', '-=', '*=', '/=', '%='];
function formatLineContent(line) {
    let result = '';
    let inString = false;
    let commentMode = null;
    let inImportPath = false;
    for (let i = 0; i < line.length; i++) {
        const char = line[i];
        const nextChar = line[i + 1];
        const prevChar = line[i - 1];
        const prevResultChar = result[result.length - 1];
        // Handle strings
        if (char === '"' && prevChar !== '\\') {
            inString = !inString;
            result += char;
            continue;
        }
        if (inString) {
            result += char;
            continue;
        }
        // Handle comments
        if (commentMode === 'line') {
            result += char;
            continue;
        }
        if (commentMode === 'block') {
            result += char;
            if (char === '*' && nextChar === '/') {
                result += nextChar;
                i++;
                commentMode = null;
            }
            continue;
        }
        if (char === '/' && nextChar === '/') {
            commentMode = 'line';
            result += char;
            continue;
        }
        if (char === '/' && nextChar === '*') {
            commentMode = 'block';
            result += char;
            continue;
        }
        if (!inImportPath && char === '<') {
            const trimmedResult = result.trimEnd();
            if (/\b(?:use|include)$/.test(trimmedResult)) {
                if (!result.endsWith(' ')) {
                    result += ' ';
                }
                inImportPath = true;
                result += char;
                continue;
            }
        }
        if (inImportPath) {
            result += char;
            if (char === '>') {
                inImportPath = false;
            }
            continue;
        }
        if (!inImportPath) {
            const twoChar = line.slice(i, i + 2);
            if (MULTI_CHAR_OPERATORS.includes(twoChar)) {
                const prevResultChar = result[result.length - 1];
                if (prevResultChar && prevResultChar !== ' ' && prevResultChar !== '(') {
                    result += ' ';
                }
                result += twoChar;
                const followingChar = line[i + 2];
                if (followingChar && followingChar !== ' ' && followingChar !== ')' && followingChar !== ';' && followingChar !== ',') {
                    result += ' ';
                }
                i++;
                continue;
            }
        }
        // Add space after commas
        if (char === ',') {
            result += char;
            if (nextChar && nextChar !== ' ' && nextChar !== '\n') {
                result += ' ';
            }
            continue;
        }
        // Add space around binary operators
        const isBinaryOp = ['=', '+', '-', '*', '/', '%', '<', '>'].includes(char);
        if (isBinaryOp) {
            // Check if it's actually a binary operator (not part of something else)
            const isActuallyBinary = (char === '=' && nextChar !== '=') ||
                (char === '!' && nextChar === '=') ||
                (char === '<' || char === '>') ||
                (['+', '-', '*', '/', '%'].includes(char));
            if (isActuallyBinary) {
                // Add space before if needed
                if (prevResultChar && prevResultChar !== ' ' && prevResultChar !== '(') {
                    result += ' ';
                }
                result += char;
                // Add space after if needed
                if (nextChar && nextChar !== ' ') {
                    result += ' ';
                }
                continue;
            }
        }
        // Default: just add the character
        result += char;
    }
    const singleLineCommentIndex = result.indexOf('//');
    const blockCommentIndex = result.indexOf('/*');
    const commentIndexes = [singleLineCommentIndex, blockCommentIndex].filter(index => index >= 0);
    const prefixEnd = commentIndexes.length > 0 ? Math.min(...commentIndexes) : result.length;
    const prefix = result.slice(0, prefixEnd);
    const suffix = result.slice(prefixEnd);
    const normalizedPrefix = prefix
        .replace(/}\s*else/g, '} else')
        .replace(/else\s*if/g, 'else if')
        .replace(/else\s*\{/g, 'else {')
        .replace(/\bif\s*\(/g, 'if (')
        .replace(/\bfor\s*\(/g, 'for (')
        .replace(/\bwhile\s*\(/g, 'while (')
        .replace(/\)\s*\{/g, ') {')
        .replace(/else if\s*\(([^)]*)\)\s*\{/g, 'else if ($1) {')
        .replace(/\b(if|for|while)\s*\(([^)]*)\)\s*\{/g, (_match, keyword, condition) => `${keyword} (${condition}) {`)
        .replace(/^(use|include)\s*<\s*([^>]+?)\s*>/g, '$1 <$2>');
    return normalizedPrefix + suffix;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3phY2hhcnltYXJpb24vc3JjL29wZW5zY2FkLXRhdXJpL2FwcHMvdWkvc3JjL3V0aWxzL29wZW5zY2FkRm9ybWF0dGVyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7O0dBU0c7O0FBWUgsZ0RBZ0dDO0FBckdELE1BQU0sZUFBZSxHQUE0QjtJQUMvQyxVQUFVLEVBQUUsQ0FBQztJQUNiLE9BQU8sRUFBRSxLQUFLO0NBQ2YsQ0FBQztBQUVGLFNBQWdCLGtCQUFrQixDQUFDLElBQVksRUFBRSxVQUF5QixFQUFFO0lBQzFFLE1BQU0sSUFBSSxHQUFHLEVBQUUsR0FBRyxlQUFlLEVBQUUsR0FBRyxPQUFPLEVBQUUsQ0FBQztJQUNoRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRXBFLGtEQUFrRDtJQUNsRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBRTNELE1BQU0sU0FBUyxHQUFhLEVBQUUsQ0FBQztJQUMvQixJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7SUFDcEIsSUFBSSxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7SUFFN0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUN0QyxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEIsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRTVCLHdDQUF3QztRQUN4QyxJQUFJLE9BQU8sS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUNuQixJQUFJLENBQUMsZ0JBQWdC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RSxnQkFBZ0IsQ0FBQztTQUN4RCxPQUFPLENBQUMsc0NBQXNDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxFQUFFLENBQUMsR0FBRyxPQUFPLEtBQUssU0FBUyxLQUFLLENBQUM7U0FDOUcsT0FBTyxDQUFDLG9DQUFvQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBRTVELE9BQU8sZ0JBQWdCLEdBQUcsTUFBTSxDQUFDO0FBQ25DLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3phY2hhcnltYXJpb24vc3JjL29wZW5zY2FkLXRhdXJpL2FwcHMvdWkvc3JjL3V0aWxzL29wZW5zY2FkRm9ybWF0dGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogT3BlblNDQUQgQ29kZSBGb3JtYXR0ZXJcbiAqXG4gKiBQcm92aWRlcyBiYXNpYyBmb3JtYXR0aW5nIGZvciBPcGVuU0NBRCBjb2RlOlxuICogLSBDb25zaXN0ZW50IGluZGVudGF0aW9uXG4gKiAtIFNwYWNpbmcgYXJvdW5kIG9wZXJhdG9yc1xuICogLSBCcmFja2V0IGFsaWdubWVudFxuICogLSBSZW1vdmVzIHRyYWlsaW5nIHdoaXRlc3BhY2VcbiAqIC0gUmVtb3ZlcyBleGNlc3NpdmUgYmxhbmsgbGluZXNcbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIEZvcm1hdE9wdGlvbnMge1xuICBpbmRlbnRTaXplPzogbnVtYmVyO1xuICB1c2VUYWJzPzogYm9vbGVhbjtcbn1cblxuY29uc3QgREVGQVVMVF9PUFRJT05TOiBSZXF1aXJlZDxGb3JtYXRPcHRpb25zPiA9IHtcbiAgaW5kZW50U2l6ZTogNCxcbiAgdXNlVGFiczogZmFsc2UsXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0T3BlblNjYWRDb2RlKGNvZGU6IHN0cmluZywgb3B0aW9uczogRm9ybWF0T3B0aW9ucyA9IHt9KTogc3RyaW5nIHtcbiAgY29uc3Qgb3B0cyA9IHsgLi4uREVGQVVMVF9PUFRJT05TLCAuLi5vcHRpb25zIH07XG4gIGNvbnN0IGluZGVudFN0ciA9IG9wdHMudXNlVGFicyA/ICdcXHQnIDogJyAnLnJlcGVhdChvcHRzLmluZGVudFNpemUpO1xuXG4gIC8vIFNwbGl0IGludG8gbGluZXMgYW5kIHJlbW92ZSB0cmFpbGluZyB3aGl0ZXNwYWNlXG4gIGNvbnN0IGxpbmVzID0gY29kZS5zcGxpdCgnXFxuJykubWFwKGxpbmUgPT4gbGluZS50cmltRW5kKCkpO1xuXG4gIGNvbnN0IGZvcm1hdHRlZDogc3RyaW5nW10gPSBbXTtcbiAgbGV0IGluZGVudExldmVsID0gMDtcbiAgbGV0IGxhc3RMaW5lV2FzQmxhbmsgPSBmYWxzZTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgbGluZSA9IGxpbmVzW2ldO1xuICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcblxuICAgIC8vIFNraXAgbXVsdGlwbGUgY29uc2VjdXRpdmUgYmxhbmsgbGluZXNcbiAgICBpZiAodHJpbW1lZCA9PT0gJycpIHtcbiAgICAgIGlmICghbGFzdExpbmVXYXNCbGFuaykge1xuICAgICAgICBmb3JtYXR0ZWQucHVzaCgnJyk7XG4gICAgICAgIGxhc3RMaW5lV2FzQmxhbmsgPSB0cnVlO1xuICAgICAgfVxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgbGFzdExpbmVXYXNCbGFuayA9IGZhbHNlO1xuXG4gICAgLy8gQ291bnQgb3BlbmluZyBhbmQgY2xvc2luZyBicmFjZXMgdG8gZGV0ZXJtaW5lIGluZGVudFxuICAgIGxldCBvcGVuQnJhY2VzID0gMDtcbiAgICBsZXQgY2xvc2VCcmFjZXMgPSAwO1xuICAgIGxldCBpblN0cmluZyA9IGZhbHNlO1xuICAgIGxldCBpbkxpbmVDb21tZW50ID0gZmFsc2U7XG4gICAgbGV0IGluQmxvY2tDb21tZW50ID0gZmFsc2U7XG5cbiAgICAvLyBGaXJzdCBwYXNzOiBjb3VudCBicmFjZXMgKGlnbm9yZSB0aG9zZSBpbiBzdHJpbmdzL2NvbW1lbnRzKVxuICAgIGZvciAobGV0IGogPSAwOyBqIDwgdHJpbW1lZC5sZW5ndGg7IGorKykge1xuICAgICAgY29uc3QgY2hhciA9IHRyaW1tZWRbal07XG4gICAgICBjb25zdCBuZXh0Q2hhciA9IHRyaW1tZWRbaiArIDFdO1xuICAgICAgY29uc3QgcHJldkNoYXIgPSB0cmltbWVkW2ogLSAxXTtcblxuICAgICAgLy8gU3RyaW5nIGhhbmRsaW5nXG4gICAgICBpZiAoY2hhciA9PT0gJ1wiJyAmJiBwcmV2Q2hhciAhPT0gJ1xcXFwnKSB7XG4gICAgICAgIGluU3RyaW5nID0gIWluU3RyaW5nO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChpblN0cmluZykgY29udGludWU7XG5cbiAgICAgIC8vIExpbmUgY29tbWVudFxuICAgICAgaWYgKGNoYXIgPT09ICcvJyAmJiBuZXh0Q2hhciA9PT0gJy8nICYmICFpbkJsb2NrQ29tbWVudCkge1xuICAgICAgICBpbkxpbmVDb21tZW50ID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7IC8vIFJlc3Qgb2YgbGluZSBpcyBjb21tZW50XG4gICAgICB9XG5cbiAgICAgIC8vIEJsb2NrIGNvbW1lbnRcbiAgICAgIGlmIChjaGFyID09PSAnLycgJiYgbmV4dENoYXIgPT09ICcqJyAmJiAhaW5MaW5lQ29tbWVudCkge1xuICAgICAgICBpbkJsb2NrQ29tbWVudCA9IHRydWU7XG4gICAgICAgIGorKzsgLy8gU2tpcCBuZXh0IGNoYXJcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoY2hhciA9PT0gJyonICYmIG5leHRDaGFyID09PSAnLycgJiYgaW5CbG9ja0NvbW1lbnQpIHtcbiAgICAgICAgaW5CbG9ja0NvbW1lbnQgPSBmYWxzZTtcbiAgICAgICAgaisrOyAvLyBTa2lwIG5leHQgY2hhclxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmIChpbkJsb2NrQ29tbWVudCkgY29udGludWU7XG5cbiAgICAgIC8vIENvdW50IGJyYWNlc1xuICAgICAgaWYgKGNoYXIgPT09ICd7Jykgb3BlbkJyYWNlcysrO1xuICAgICAgaWYgKGNoYXIgPT09ICd9JykgY2xvc2VCcmFjZXMrKztcbiAgICB9XG5cbiAgICAvLyBEZXRlcm1pbmUgaW5kZW50IGZvciB0aGlzIGxpbmVcbiAgICAvLyBJZiBsaW5lIHN0YXJ0cyB3aXRoIH0sIGRlY3JlYXNlIGluZGVudCBiZWZvcmVcbiAgICBsZXQgbGluZUluZGVudCA9IGluZGVudExldmVsO1xuICAgIGlmICh0cmltbWVkLnN0YXJ0c1dpdGgoJ30nKSkge1xuICAgICAgbGluZUluZGVudCA9IE1hdGgubWF4KDAsIGluZGVudExldmVsIC0gMSk7XG4gICAgfVxuXG4gICAgLy8gRm9ybWF0IHRoZSBsaW5lIGNvbnRlbnQgKGFkZCBzcGFjaW5nLCBldGMuKVxuICAgIGNvbnN0IGZvcm1hdHRlZENvbnRlbnQgPSBmb3JtYXRMaW5lQ29udGVudCh0cmltbWVkKTtcblxuICAgIC8vIEFkZCB0aGUgZm9ybWF0dGVkIGxpbmUgd2l0aCBwcm9wZXIgaW5kZW50YXRpb25cbiAgICBmb3JtYXR0ZWQucHVzaChpbmRlbnRTdHIucmVwZWF0KGxpbmVJbmRlbnQpICsgZm9ybWF0dGVkQ29udGVudCk7XG5cbiAgICAvLyBVcGRhdGUgaW5kZW50IGxldmVsIGZvciBuZXh0IGxpbmVcbiAgICAvLyBDbG9zaW5nIGJyYWNlcyBkZWNyZWFzZSBsZXZlbFxuICAgIGluZGVudExldmVsID0gTWF0aC5tYXgoMCwgaW5kZW50TGV2ZWwgLSBjbG9zZUJyYWNlcyk7XG4gICAgLy8gT3BlbmluZyBicmFjZXMgaW5jcmVhc2UgbGV2ZWxcbiAgICBpbmRlbnRMZXZlbCArPSBvcGVuQnJhY2VzO1xuICB9XG5cbiAgLy8gUmVtb3ZlIHRyYWlsaW5nIGJsYW5rIGxpbmVzIGFuZCBlbnN1cmUgc2luZ2xlIG5ld2xpbmUgYXQgZW5kXG4gIHdoaWxlIChmb3JtYXR0ZWQubGVuZ3RoID4gMCAmJiBmb3JtYXR0ZWRbZm9ybWF0dGVkLmxlbmd0aCAtIDFdLnRyaW0oKSA9PT0gJycpIHtcbiAgICBmb3JtYXR0ZWQucG9wKCk7XG4gIH1cblxuICByZXR1cm4gZm9ybWF0dGVkLmpvaW4oJ1xcbicpICsgJ1xcbic7XG59XG5cbi8qKlxuICogRm9ybWF0IHRoZSBjb250ZW50IG9mIGEgc2luZ2xlIGxpbmUgKHNwYWNpbmcgYXJvdW5kIG9wZXJhdG9ycywgZXRjLilcbiAqL1xuY29uc3QgTVVMVElfQ0hBUl9PUEVSQVRPUlMgPSBbJzw9JywgJz49JywgJz09JywgJyE9JywgJys9JywgJy09JywgJyo9JywgJy89JywgJyU9J107XG5cbmZ1bmN0aW9uIGZvcm1hdExpbmVDb250ZW50KGxpbmU6IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCByZXN1bHQgPSAnJztcbiAgbGV0IGluU3RyaW5nID0gZmFsc2U7XG4gIGxldCBjb21tZW50TW9kZTogJ2xpbmUnIHwgJ2Jsb2NrJyB8IG51bGwgPSBudWxsO1xuICBsZXQgaW5JbXBvcnRQYXRoID0gZmFsc2U7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY2hhciA9IGxpbmVbaV07XG4gICAgY29uc3QgbmV4dENoYXIgPSBsaW5lW2kgKyAxXTtcbiAgICBjb25zdCBwcmV2Q2hhciA9IGxpbmVbaSAtIDFdO1xuICAgIGNvbnN0IHByZXZSZXN1bHRDaGFyID0gcmVzdWx0W3Jlc3VsdC5sZW5ndGggLSAxXTtcblxuICAgIC8vIEhhbmRsZSBzdHJpbmdzXG4gICAgaWYgKGNoYXIgPT09ICdcIicgJiYgcHJldkNoYXIgIT09ICdcXFxcJykge1xuICAgICAgaW5TdHJpbmcgPSAhaW5TdHJpbmc7XG4gICAgICByZXN1bHQgKz0gY2hhcjtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBpZiAoaW5TdHJpbmcpIHtcbiAgICAgIHJlc3VsdCArPSBjaGFyO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIGNvbW1lbnRzXG4gICAgaWYgKGNvbW1lbnRNb2RlID09PSAnbGluZScpIHtcbiAgICAgIHJlc3VsdCArPSBjaGFyO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKGNvbW1lbnRNb2RlID09PSAnYmxvY2snKSB7XG4gICAgICByZXN1bHQgKz0gY2hhcjtcbiAgICAgIGlmIChjaGFyID09PSAnKicgJiYgbmV4dENoYXIgPT09ICcvJykge1xuICAgICAgICByZXN1bHQgKz0gbmV4dENoYXI7XG4gICAgICAgIGkrKztcbiAgICAgICAgY29tbWVudE1vZGUgPSBudWxsO1xuICAgICAgfVxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKGNoYXIgPT09ICcvJyAmJiBuZXh0Q2hhciA9PT0gJy8nKSB7XG4gICAgICBjb21tZW50TW9kZSA9ICdsaW5lJztcbiAgICAgIHJlc3VsdCArPSBjaGFyO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKGNoYXIgPT09ICcvJyAmJiBuZXh0Q2hhciA9PT0gJyonKSB7XG4gICAgICBjb21tZW50TW9kZSA9ICdibG9jayc7XG4gICAgICByZXN1bHQgKz0gY2hhcjtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICghaW5JbXBvcnRQYXRoICYmIGNoYXIgPT09ICc8Jykge1xuICAgICAgY29uc3QgdHJpbW1lZFJlc3VsdCA9IHJlc3VsdC50cmltRW5kKCk7XG4gICAgICBpZiAoL1xcYig/OnVzZXxpbmNsdWRlKSQvLnRlc3QodHJpbW1lZFJlc3VsdCkpIHtcbiAgICAgICAgaWYgKCFyZXN1bHQuZW5kc1dpdGgoJyAnKSkge1xuICAgICAgICAgIHJlc3VsdCArPSAnICc7XG4gICAgICAgIH1cbiAgICAgICAgaW5JbXBvcnRQYXRoID0gdHJ1ZTtcbiAgICAgICAgcmVzdWx0ICs9IGNoYXI7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpbkltcG9ydFBhdGgpIHtcbiAgICAgIHJlc3VsdCArPSBjaGFyO1xuICAgICAgaWYgKGNoYXIgPT09ICc+Jykge1xuICAgICAgICBpbkltcG9ydFBhdGggPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICghaW5JbXBvcnRQYXRoKSB7XG4gICAgICBjb25zdCB0d29DaGFyID0gbGluZS5zbGljZShpLCBpICsgMik7XG4gICAgICBpZiAoTVVMVElfQ0hBUl9PUEVSQVRPUlMuaW5jbHVkZXModHdvQ2hhcikpIHtcbiAgICAgICAgY29uc3QgcHJldlJlc3VsdENoYXIgPSByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDFdO1xuICAgICAgICBpZiAocHJldlJlc3VsdENoYXIgJiYgcHJldlJlc3VsdENoYXIgIT09ICcgJyAmJiBwcmV2UmVzdWx0Q2hhciAhPT0gJygnKSB7XG4gICAgICAgICAgcmVzdWx0ICs9ICcgJztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQgKz0gdHdvQ2hhcjtcbiAgICAgICAgY29uc3QgZm9sbG93aW5nQ2hhciA9IGxpbmVbaSArIDJdO1xuICAgICAgICBpZiAoZm9sbG93aW5nQ2hhciAmJiBmb2xsb3dpbmdDaGFyICE9PSAnICcgJiYgZm9sbG93aW5nQ2hhciAhPT0gJyknICYmIGZvbGxvd2luZ0NoYXIgIT09ICc7JyAmJiBmb2xsb3dpbmdDaGFyICE9PSAnLCcpIHtcbiAgICAgICAgICByZXN1bHQgKz0gJyAnO1xuICAgICAgICB9XG4gICAgICAgIGkrKztcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWRkIHNwYWNlIGFmdGVyIGNvbW1hc1xuICAgIGlmIChjaGFyID09PSAnLCcpIHtcbiAgICAgIHJlc3VsdCArPSBjaGFyO1xuICAgICAgaWYgKG5leHRDaGFyICYmIG5leHRDaGFyICE9PSAnICcgJiYgbmV4dENoYXIgIT09ICdcXG4nKSB7XG4gICAgICAgIHJlc3VsdCArPSAnICc7XG4gICAgICB9XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICAvLyBBZGQgc3BhY2UgYXJvdW5kIGJpbmFyeSBvcGVyYXRvcnNcbiAgICBjb25zdCBpc0JpbmFyeU9wID0gWyc9JywgJysnLCAnLScsICcqJywgJy8nLCAnJScsICc8JywgJz4nXS5pbmNsdWRlcyhjaGFyKTtcbiAgICBpZiAoaXNCaW5hcnlPcCkge1xuICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhY3R1YWxseSBhIGJpbmFyeSBvcGVyYXRvciAobm90IHBhcnQgb2Ygc29tZXRoaW5nIGVsc2UpXG4gICAgICBjb25zdCBpc0FjdHVhbGx5QmluYXJ5ID1cbiAgICAgICAgKGNoYXIgPT09ICc9JyAmJiBuZXh0Q2hhciAhPT0gJz0nKSB8fFxuICAgICAgICAoY2hhciA9PT0gJyEnICYmIG5leHRDaGFyID09PSAnPScpIHx8XG4gICAgICAgIChjaGFyID09PSAnPCcgfHwgY2hhciA9PT0gJz4nKSB8fFxuICAgICAgICAoWycrJywgJy0nLCAnKicsICcvJywgJyUnXS5pbmNsdWRlcyhjaGFyKSk7XG5cbiAgICAgIGlmIChpc0FjdHVhbGx5QmluYXJ5KSB7XG4gICAgICAgIC8vIEFkZCBzcGFjZSBiZWZvcmUgaWYgbmVlZGVkXG4gICAgICAgIGlmIChwcmV2UmVzdWx0Q2hhciAmJiBwcmV2UmVzdWx0Q2hhciAhPT0gJyAnICYmIHByZXZSZXN1bHRDaGFyICE9PSAnKCcpIHtcbiAgICAgICAgICByZXN1bHQgKz0gJyAnO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdCArPSBjaGFyO1xuICAgICAgICAvLyBBZGQgc3BhY2UgYWZ0ZXIgaWYgbmVlZGVkXG4gICAgICAgIGlmIChuZXh0Q2hhciAmJiBuZXh0Q2hhciAhPT0gJyAnKSB7XG4gICAgICAgICAgcmVzdWx0ICs9ICcgJztcbiAgICAgICAgfVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBEZWZhdWx0OiBqdXN0IGFkZCB0aGUgY2hhcmFjdGVyXG4gICAgcmVzdWx0ICs9IGNoYXI7XG4gIH1cblxuICBjb25zdCBzaW5nbGVMaW5lQ29tbWVudEluZGV4ID0gcmVzdWx0LmluZGV4T2YoJy8vJyk7XG4gIGNvbnN0IGJsb2NrQ29tbWVudEluZGV4ID0gcmVzdWx0LmluZGV4T2YoJy8qJyk7XG4gIGNvbnN0IGNvbW1lbnRJbmRleGVzID0gW3NpbmdsZUxpbmVDb21tZW50SW5kZXgsIGJsb2NrQ29tbWVudEluZGV4XS5maWx0ZXIoaW5kZXggPT4gaW5kZXggPj0gMCk7XG4gIGNvbnN0IHByZWZpeEVuZCA9IGNvbW1lbnRJbmRleGVzLmxlbmd0aCA+IDAgPyBNYXRoLm1pbiguLi5jb21tZW50SW5kZXhlcykgOiByZXN1bHQubGVuZ3RoO1xuICBjb25zdCBwcmVmaXggPSByZXN1bHQuc2xpY2UoMCwgcHJlZml4RW5kKTtcbiAgY29uc3Qgc3VmZml4ID0gcmVzdWx0LnNsaWNlKHByZWZpeEVuZCk7XG5cbiAgY29uc3Qgbm9ybWFsaXplZFByZWZpeCA9IHByZWZpeFxuICAgIC5yZXBsYWNlKC99XFxzKmVsc2UvZywgJ30gZWxzZScpXG4gICAgLnJlcGxhY2UoL2Vsc2VcXHMqaWYvZywgJ2Vsc2UgaWYnKVxuICAgIC5yZXBsYWNlKC9lbHNlXFxzKlxcey9nLCAnZWxzZSB7JylcbiAgICAucmVwbGFjZSgvXFxiaWZcXHMqXFwoL2csICdpZiAoJylcbiAgICAucmVwbGFjZSgvXFxiZm9yXFxzKlxcKC9nLCAnZm9yICgnKVxuICAgIC5yZXBsYWNlKC9cXGJ3aGlsZVxccypcXCgvZywgJ3doaWxlICgnKVxuICAgIC5yZXBsYWNlKC9cXClcXHMqXFx7L2csICcpIHsnKVxuICAgIC5yZXBsYWNlKC9lbHNlIGlmXFxzKlxcKChbXildKilcXClcXHMqXFx7L2csICdlbHNlIGlmICgkMSkgeycpXG4gICAgLnJlcGxhY2UoL1xcYihpZnxmb3J8d2hpbGUpXFxzKlxcKChbXildKilcXClcXHMqXFx7L2csIChfbWF0Y2gsIGtleXdvcmQsIGNvbmRpdGlvbikgPT4gYCR7a2V5d29yZH0gKCR7Y29uZGl0aW9ufSkge2ApXG4gICAgLnJlcGxhY2UoL14odXNlfGluY2x1ZGUpXFxzKjxcXHMqKFtePl0rPylcXHMqPi9nLCAnJDEgPCQyPicpO1xuXG4gIHJldHVybiBub3JtYWxpemVkUHJlZml4ICsgc3VmZml4O1xufVxuIl0sInZlcnNpb24iOjN9